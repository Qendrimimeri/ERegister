@model PoliticalOfficalVM;
@inject Microsoft.AspNetCore.Identity.UserManager<ApplicationUser> _userManager;
@inject IUnitOfWork _unitOfWork;
@inject IOptionsSnapshot<Roles> _roles;
@{
    Layout = "_DashboardLayout";
    var userId = await _userManager.FindByNameAsync(User.Identity.Name);
    var userMuniId = await _unitOfWork.ApplicationUser.GetMunicipalityIdOfUser(userId.Id);
    var userVillageId = await _unitOfWork.ApplicationUser.GetVillageIdOfUser((userId.Id));
    var roles = _roles.Value;
    int? userNeigborhoodId;

    if (userVillageId == null)
    {
        userNeigborhoodId = await _unitOfWork.ApplicationUser.GetNeigborhoodIdOfCityForUser(userId.Id);
    }
    else
    {
        userNeigborhoodId = await _unitOfWork.ApplicationUser.GetNeigborhoodIdOfVillageForUser(userId.Id, userVillageId);
    }
}
<head>
    <link rel="stylesheet" href="~/cssViews/PoliticalOfficial.css">
</head>


<section class="section">
    <input hidden asp-for="@userMuniId" id="get-user-muniId"/>
    <input hidden asp-for="@userVillageId" id="get-user-villageId"/>
    <input hidden asp-for="@userNeigborhoodId" id="get-user-neighborhoodId"/>
    <div class="row">
        <div class="col-lg-12">
            <div class="card ">
                <div class="card-body" id="">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h5 class="card-title" id="titulli">Krijo llogarinë për zyrtarin e partisë dhe territorin përkatës</h5>
                        </div>
                        @if (User.IsInRole(roles.KryetarIPartise))
                        {
                            <div>
                                <partial name="_ManualiAdminPoliticalOfficialPartial"></partial>
                            </div>
                        }
                        @if (User.IsInRole(roles.KryetarIKomunes))
                        {
                            <div>
                                <partial name="_ManualiKryetarKomunesPoliticalOfficialPartial"></partial>
                            </div>
                        }
                        @if (User.IsInRole(roles.KryetarIFshatit))
                        {
                            <div>
                                <partial name="_ManualiKryetarFshatitPoliticalOfficialPartial"></partial>
                            </div>
                        }
                    </div>
                    <form asp-action="PoliticalOffical" method="post" id="forma">
                        <h6 class="pt-4">I - Të dhënat personale</h6>
                        <hr />
                        <div class="mb-4 d-flex justify-content-between">
                            <div class="col-12 pe-2">
                                <label asp-for="FullName">Emri dhe mbiemri</label>
                                <input asp-for="FullName" class="form-control" id="mbiemripersonal"
                                       placeholder="Shkruaj emrin dhe mbiemrin">
                                <span asp-validation-for="FullName" class="text-danger"></span>
                                <div class="demo"></div>
                            </div>
                        </div>
                        <span>Numri i telefonit</span>
                        <div class="mb-4 pe-2 ">
                            <div class=" d-flex align-items-center flex-sm-row">
                                <div class="col-4 col-sm-2">
                                    <input asp-for="PrefixPhoneNo" type="text" class="form-control" id="prefix" value="+383">
                                </div>
                                <div class="col-8 ps-2 col-sm-10">
                                    <input asp-for="PhoneNumber" class="form-control" id="nrtel" type="number" placeholder="" min="0">
                                </div>
                            </div>
                            <span asp-validation-for="PhoneNumber" class="text-danger"></span>

                            <span class="text-danger"></span>
                        </div>
                        <div class="form-group pb-3 pe-2">
                            <label for="exampleInputEmail1" asp-for="Email">Email adresa</label>
                            <input type="email" asp-for="Email" class="form-control" id="exampleInputEmail1"
                                   placeholder="Shkruaj email adresen">
                            <span asp-validation-for="Email" class="text-danger"></span>
                            @if (ViewBag.EmailExist == "nuk ka email")
                            {
                                <span class="text-danger"> Email adresa e dhënë është regjistruar </span>
                            }
                        </div>
                        <div class="mb-2 d-flex justify-content-between flex-md-row flex-column">
                            @if (User.IsInRole(roles.KryetarIPartise))
                            {
                                <div class="col-md-4 mb-2 pe-2">
                                    <label asp-for="Municipality"> Qyteti </label>
                                    <select class="form-select option-select" asp-for="Municipality" id="munis">
                                        <option disabled selected>Zgjedh qytetin...</option>
                                    </select>
                                    <span asp-validation-for="Municipality" class="text-danger"></span>
                                </div>
                                <div class="col-md-4 mb-2 pe-2">
                                    <label asp-for="Village">Fshati</label>
                                    <select asp-for="Village" id="villages" class="form-select option-select">
                                        <option disabled selected>Zgjedh fshatin...</option>
                                    </select>
                                </div>
                                <div id="neigborhoods-container" class="col-md-4 mb-2 pe-2">
                                    <label>Lagja</label>
                                    <select class="form-select option-select" asp-for="Neigborhood" id="neigborhoods">
                                        <option disabled selected>Zgjedh lagjen...</option>
                                    </select>
                                </div>
                                <div id="neigborhoodsVillage-container" class="col-md-4 mb-2 pe-2">
                                    <label>Lagja</label>
                                    <select class="form-select option-select" asp-for="Neigborhood" id="neigborhoodsVillage">
                                        <option disabled selected>Zgjedh lagjen...</option>
                                    </select>
                                </div>

                            }
                            @if (User.IsInRole(roles.KryetarIKomunes))
                            {
                                <div class="col-md-6 mb-2 pe-2">
                                    <label asp-for="Village">Fshati</label>
                                    <select asp-for="Village" id="villages" class="form-select option-select">
                                        <option disabled selected>Zgjedh fshatin...</option>
                                    </select>
                                </div>
                                <div id="neigborhoods-container" class="col-md-6 mb-2 pe-2">
                                    <label>Lagja</label>
                                    <select class="form-select option-select" asp-for="Neigborhood" id="neigborhoods">
                                        <option disabled selected>Zgjedh lagjen...</option>
                                    </select>
                                </div>
                                <div id="neigborhoodsVillage-container" class="col-md-6 mb-2 pe-2">
                                    <label>Lagja</label>
                                    <select class="form-select option-select" asp-for="Neigborhood" id="neigborhoodsVillage">
                                        <option disabled selected>Zgjedh lagjen...</option>
                                    </select>
                                </div>
                            }
                        </div>
                        @if (User.IsInRole(roles.KryetarIFshatit))
                        {
                            <div class=" d-flex justify-content-between flex-sm-row flex-column">
                                <div id="neigborhoodsVillage-container" class="col-md-4 mb-3 pe-2">
                                    <label>Lagja</label>
                                    <select class="form-select option-select" asp-for="Neigborhood" id="neigborhoodsVillage">
                                        <option disabled selected>Zgjedh lagjen...</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3 pe-2" id="streetByVillage">
                                    <label>Rruga</label>
                                    <select class="form-select option-select" asp-for="Street" id="streets">
                                        <option disabled selected>Zgjedh rrugën...</option>
                                    </select>
                                </div>
                                <div class=col-md-4 mb-3 pe-2" id="streetByNeighborhood">
                                    <label>Rruga</label>
                                    <select class="form-select option-select" asp-for="Street" id="streetsNeighborhood">
                                        <option disabled selected>Zgjedh rrugën...</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3 pe-2">
                                    <label class="">Numri i shtëpisë</label>
                                    <input class="form-control" placeholder="opsionale" asp-for="HouseNo" min="0">
                                    <span class="text-danger"></span>
                                </div>
                            </div>
                        }
                        @if (User.IsInRole(roles.KryetarIPartise) || User.IsInRole(roles.KryetarIKomunes) || User.IsInRole(roles.AnetarIThjeshte))
                        {
                            <div class="mb-4 d-flex justify-content-between flex-md-row flex-column">
                                <div class="col-md-4 mb-2 pe-2" id="streetByVillage">
                                    <label>Rruga</label>
                                    <select class="form-select option-select" asp-for="Street" id="streets">
                                        <option disabled selected>Zgjedh rrugën...</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3 pe-2" id="streetByNeighborhood">
                                    <label>Rruga</label>
                                    <select class="form-select option-select" asp-for="Street" id="streetsNeighborhood">
                                        <option disabled selected>Zgjedh rrugën...</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3 pe-2">
                                    <label>Blloku</label>
                                    <select class="form-select option-select" asp-for="Block" id="blocks">
                                        <option disabled selected>Zgjedh bllokun...</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3 pe-2">
                                    <label class="">Numri i shtëpisë</label>
                                    <input class="form-control option-select" min="0" placeholder="opsionale" asp-for="HouseNo">
                                    <span class="text-danger"></span>
                                </div>
                            </div>
                        }
                        <h6 class="pt-4">II - Të dhënat partiake</h6>
                        <hr />
                        <div class="mb-4 d-flex justify-content-between flex-md-row flex-column">
                            <div class="col-md-6 mb-2 pe-2">
                                <label asp-for="Role">Pozita në parti</label>
                                <select asp-for="Role" asp-items="@ViewBag.roles" class="form-select option-select"
                                        id="inputGroupSelect05">
                                    <option disabled selected>Zgjedh rolin...</option>
                                </select>
                                <span asp-validation-for="Role" class="text-danger"></span>
                                @*<a asp-controller = "Role" asp-action = "AddRoles" class="link-primary">Shto +</a>*@
                            </div>
                            <div class="col-md-6 mb-2 pe-2" id="pollcenter-villages-container">
                                <label asp-for="PollCenter">Qendra e votimit</label>
                                <select asp-for="PollCenter" onchange="getPollCenterId()" class="form-select option-select" id="poll">
                                    <option disabled selected>Zgjedh qendren e votimit...</option>
                                </select>
                                <small class="text-danger" id="response-city"></small>
                                <span asp-validation-for="PollCenter" class="text-danger"></span>
                            </div>
                            <div class="col-md-6 mb-2 pe-2" id="pollcenter-neighborhood-container">
                                <label asp-for="PollCenter">Qendra e votimit</label>
                                <select asp-for="PollCenter" onchange="getPollCenterId()" class="form-select option-select" id="pollNeighborhood">
                                    <option disabled selected>Zgjedh qendren e votimit...</option>
                                </select>
                                <small class="text-danger" id="response-village"></small>
                                <span asp-validation-for="PollCenter" class="text-danger"></span>
                            </div>

                            @*ME HJEK*@
                            <hr />
                        </div>
                        <h6 class="pt-4">III - Të dhënat e zgjedhjeve</h6>
                        <hr />
                        <div class="mb-4 d-flex justify-content-between flex-md-row flex-column">
                            <div class="col-md-6 mb-2 pe-2 zgjedhje">
                                <label class="">Lloji i zgjedhjeve</label>
                                <select asp-for="ElectionType" asp-items="@ViewBag.electionType" class="form-select option-select" id="inputGroupSelect03">
                                    <option value="0" disabled selected>Zgjedh llojin e zgjedhjeve...</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-2 pe-2 data">
                                <label class="">Data e zgjedhjeve</label>
                                <input asp-for="ElectionDate" type="date" id="year" class="form-control">
                            </div>
                        </div>
                        <div class="col-md-6 w-100 ">

                            <div class="table-responsive">
                                <table class="table table-responsive align-center table-bordered">
                                    <thead>
                                        <tr>
                                            <th scope="col">Partia Politike</th>
                                            <th scope="col">Totali i votave : <span id="span" class="float-end"></span>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <th scope="row" class="parti" value="1">VV</th>
                                            <td><input asp-for="VV" placeholder="Shkruaj numrin e votave..." min="0" type="number" class="partyNumber border-0 votat w-100" /></td>
                                        </tr>
                                        <tr>
                                            <th scope="row" class="parti" value="2">LDK</th>
                                            <td><input asp-for="LDK" placeholder="Shkruaj numrin e votave..." min="0" type="number" class="partyNumber border-0 votat w-100 c" /></td>
                                        </tr>
                                        <tr>
                                            <th scope="row" class="parti" value="3">PDK</th>
                                            <td><input asp-for="PDK" placeholder="Shkruaj numrin e votave..." min="0" type="number" class="partyNumber border-0 votat w-100 " /></td>
                                        </tr>
                                        <tr>
                                            <th scope="row" class="parti" value="4">AAK</th>
                                            <td><input asp-for="AAK" placeholder="Shkruaj numrin e votave..." min="0" type="number" class="partyNumber border-0 votat w-100 c" /></td>
                                        </tr>
                                        <tr>
                                            <th scope="row" class="parti" value="5">AKR</th>
                                            <td><input asp-for="AKR" placeholder="Shkruaj numrin e votave..." min="0" type="number" class="partyNumber border-0 votat w-100" /></td>
                                        </tr>
                                        <tr>
                                            <th scope="row" class="parti" value="6">Nisma</th>
                                            <td><input asp-for="NISMA" placeholder="Shkruaj numrin e votave..." min="0" type="number" class="partyNumber border-0 votat w-100 c" /></td>
                                        </tr>
                                        <tr>
                                            <th scope="row" class="parti" value="7">Partite serbe</th>
                                            <td><input asp-for="PartitSerbe" placeholder="Shkruaj numrin e votave..." min="0" type="number" class="partyNumber border-0 votat w-100" /></td>
                                        </tr>
                                        <tr>
                                            <th scope="row" class="parti" value="8">Partite joserbe</th>
                                            <td><input asp-for="PartitJoSerbe" placeholder="Shkruaj numrin e votave..." min="0" type="number" class="partyNumber border-0 votat w-100 c" /></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            @if (ViewBag.KqzValidation == true)
                            {
                                <div class="text-danger p-0 m-0">
                                    Ju lutem plotësoni të dhënat për KQZ.
                                </div>
                            }
                        </div>
                        <div class="d-flex flex-row justify-content-end pe-2 pt-3 ">
                            <a href='javascript:
                               swal({
                               title: "A jeni të sigurtë?" ,
                               icon: "warning" ,
                               buttons: {
                               cancel:"Jo",
                               confirm:{
                               text:"Po",
                               className:"test",
                               } }
                               })
                               .then((willDelete)=>
                                {
                                if (willDelete) {
                                swal({ title: "U anulua me sukses!",
                                icon: "success"}).then(okay => {
                                if (okay) {
                                window.location.href = "/AddsAdmin/PoliticalOffical";
                                }
                                });
                                } else {
                                swal({
                                title: "Te dhënat nuk janë anuluar!",
                                icon: "error",
                                });
                                }
                                });' class = "btn btn-danger button-responsive">Anulo
                            </a>&nbsp&nbsp
                            <button type="submit" asp-action="SaveAndOpenCasePoliticalOfficial" asp-controller="AddsAdmin" id="main-button" class="btn btn-primary pe-2 button-responsive">Ruaj dhe hap rast</button>&nbsp&nbsp
                            <button type="submit" id="second-button" class="btn btn-primary pe-2 button-responsive">Ruaj dhe mbyll</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

@if (User.IsInRole(roles.KryetarIKomunes))
{
    @section Scripts
    {
        <script src="~/js/kqz_validations.js" asp-append-version="true"></script>
        <script src ="~/js/politicalOfficial_kryetar_komunes.js"></script>
    <script>
        var strValue = "@((string)ViewBag.SaveAndOpenPolitical)";
            if (strValue !== null && strValue !== "") {
                swal({
                    icon: "success",
                    text: strValue,
                    timer: 2000,
                    showCancelButton: false,
                    showConfirmButton: false
                })
            }
        </script>
    }
}
else if (User.IsInRole(roles.KryetarIFshatit))
{
    @section Scripts
    {
        <script src="~/js/kqz_validations.js" asp-append-version="true"></script>
        <script src ="~/js/politicalOfficial_kryetari_fshatit.js"></script>
    <script>
        var strValue = "@((string)ViewBag.SaveAndOpenPolitical)";
            if (strValue !== null && strValue !== "") {
                swal({
                    icon: "success",
                    text: strValue,
                    timer: 2000,
                    showCancelButton: false,
                    showConfirmButton: false
                })
            }
        </script>
    }
}
else
{
    @section Scripts
    {
    <script>
        var strValue = "@((string)ViewBag.SaveAndOpenPolitical)";
            if (strValue !== null && strValue !== "") {
                swal({
                    icon: "success",
                    text: strValue,
                    timer: 2000,
                    showCancelButton: false,
                    showConfirmButton: false
                })
            }
        </script>
        <script src="~/js/kqz_validation_for_admin.js" asp-append-version="true"></script>
        <script src ="~/js/politicalOfficial_admin.js"></script>
        <script src="~/js/add_political_subject.js" asp-append-version="true"></script>
    }
}

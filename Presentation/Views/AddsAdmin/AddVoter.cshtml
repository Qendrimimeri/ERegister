@model RegisterVM;
@inject Microsoft.AspNetCore.Identity.UserManager<ApplicationUser> _userManager
@inject IUnitOfWork _unitOfWork;
@inject IOptionsSnapshot<Roles> _roles;
@{
    Layout = "_DashboardLayout";
    var user = await _userManager.FindByNameAsync(User.Identity.Name);
    var userMuniId = await _unitOfWork.ApplicationUser.GetMunicipalityIdOfUser(user.Id);
    int? userVillageId = await _unitOfWork.ApplicationUser.GetVillageIdOfUser((user.Id));
    int? userNeigborhoodId;
    var roles = _roles.Value;

    if (userVillageId == null)
    {
        userNeigborhoodId = await _unitOfWork.ApplicationUser.GetNeigborhoodIdOfCityForUser(user.Id);
    }
    else
    {
        userNeigborhoodId = await _unitOfWork.ApplicationUser.GetNeigborhoodIdOfVillageForUser(user.Id, userVillageId);
    }
}

<link rel="stylesheet" href="~/cssViews/AddVoter.css">
<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<section class="section">
    <input hidden asp-for="@userMuniId" id="get-user-muniId"/>
    <input hidden asp-for="@userVillageId" id="get-user-villageId"/>
    <input hidden asp-for="@userNeigborhoodId" id="get-user-neighborhoodId"/>
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h2 class="card-title ">Regjistro të dhënat për votuesin</h2>
                        </div>
                        
                        <div>
                            <partial name="_ManualiAdminAddsAdminPartial"></partial>
                        </div>
                    </div>
                   

                    <form asp-action="Register" asp-controller="AddsAdmin" method="post" id="listform">
                        <h6 class="pt-4">I - Të dhënat përsonale</h6>
                        <hr>
                        <div class="pb-3 d-flex pe-2 justify-content-between">
                            <div class="col-12 p">
                                <label asp-for="FullName" class="">Emri dhe mbiemri</label>
                                <input class="form-control" asp-for="FullName" placeholder="Shkruaj emrin dhe mbiemrin" >
                                <span asp-validation-for="FullName" class="text-danger"></span>
                            </div>
                        </div>
                        <span>Numri i telefonit</span>
                        <div class="pb-3 pe-2">
                            <div class=" d-flex align-items-center flex-sm-row">
                                <div class="col-4 col-sm-2">
                                    <input asp-for="PrefixPhoneNo" type="text" class="form-control" id="prefix" value="+383">
                                </div>
                                <div class="col-8 ps-2 col-sm-10">
                                    <input class="form-control" asp-for="PhoneNumber" type="number" min="0" placeholder=""  >
                                </div>
                            </div>
                            <span asp-validation-for="PhoneNumber" class="text-danger"></span>
                            <span class="text-danger"></span>
                        </div>
                        <div class="form-group pb-3 pe-2">
                            <label for="exampleInputEmail1">Email adresa</label>
                            <input type="email" class="form-control" id="exampleInputEmail1" asp-for="Email"  placeholder="Shkruaj email adresen">
                            <span asp-validation-for="Email" class="text-danger"></span>
                            @if (ViewBag.UserExist == "Ky email egziston ne sistem")
                            {
                                <span class="text-danger">@ViewBag.UserExist</span>
                            }
                        </div>
                        <div class="form-group pb-3 pe-2">
                            <label for="InputFacebook">Shkruaj linkun e facebook-ut të personit</label>
                            <input type="text" class="form-control" asp-for="Facebook"  id="InputFacebook">
                        </div>
                        <div class="d-flex justify-content-between flex-md-row flex-column">
                            @if (User.IsInRole(roles.KryetarIPartise))
                            {
                                <div class="col-md-4 mb-3 pe-2">
                                    <label asp-for="Municipality">Qyteti</label>
                                    <select class="form-select option-select" asp-for="Municipality" id="munis">
                                        <option disabled selected class="option-select">Zgjedh qytetin...</option>
                                    </select>
                                    <span asp-validation-for="Municipality" class="text-danger"></span>
                                </div>
                                <div class="col-md-4 mb-3 pe-2">
                                    <label>Fshati</label>
                                    <select class="form-select fshati-selected option-select" asp-for="Village" id="villages">
                                        <option value=" " disabled selected selectcard>Zgjedh fshatin...</option>
                                    </select>
                                    <span asp-validation-for="Village" class="text-danger"></span>

                                </div>
                                <div id="neigborhoods-container" class="col-md-4 mb-3 pe-2">
                                    <label>Lagja</label>
                                    <select class="form-select option-select" asp-for="Neigborhood" id="neigborhoods">
                                        <option disabled selected>Zgjedh lagjen...</option>
                                    </select>
                                    <span asp-validation-for="Neigborhood" class="text-danger"></span>
                                </div>
                                <div id="neigborhoodsVillage-container" class="col-md-4 mb-3 pe-2">
                                    <label>Lagja</label>
                                    <select class="form-select option-select" asp-for="Neigborhood" id="neigborhoodsVillage">
                                        <option disabled selected>Zgjedh lagjen...</option>
                                    </select>
                                    <span asp-validation-for="Neigborhood" class="text-danger"></span>
                                </div>
                            }
                            @if (User.IsInRole(roles.KryetarIKomunes))
                            {
                                <div class="col-md-6 mb-3 pe-2">
                                    <label>Fshati</label>
                                    <select class="form-select fshati-selected option-select" asp-for="Village" id="villages">
                                        <option value=" " disabled selected selectcard>Zgjedh fshatin...</option>
                                    </select>
                                   <span asp-validation-for="Village" class="text-danger"></span>

                                </div>
                                <div id="neigborhoods-container" class="col-md-6 mb-3 pe-2">
                                    <label>Lagja</label>
                                    <select class="form-select option-select" asp-for="Neigborhood" id="neigborhoods">
                                        <option disabled selected>Zgjedh lagjen...</option>
                                    </select>
                                  <span asp-validation-for="Neigborhood" class="text-danger"></span>

                                </div>
                                <div id="neigborhoodsVillage-container" class="col-md-6 mb-3 pe-2">
                                    <label>Lagja</label>
                                    <select class="form-select option-select" asp-for="Neigborhood" id="neigborhoodsVillage">
                                        <option disabled selected>Zgjedh lagjen...</option>
                                    </select>
                                    <span asp-validation-for="Neigborhood" class="text-danger"></span>

                                </div>
                            }
                        </div>
                        @if (User.IsInRole(roles.KryetarIFshatit))
                        {
                            <div class=" d-flex justify-content-between flex-sm-row flex-column">
                                <div id="neigborhoodsVillage-container" class="col-md-4 mb-3 pe-2">
                                    <label>Lagja</label>
                                    <select class="form-select option-select" asp-for="Neigborhood" id="neigborhoodsVillage">
                                        <option disabled selected>Zgjedh lagjen...</option>
                                    </select>
                                    <span asp-validation-for="Neigborhood" class="text-danger"></span>

                                </div>
                                <div class="col-md-4 mb-3 pe-2" id="streetByVillage">
                                    <label>Rruga </label>
                                    <select class="form-select option-select" asp-for="Street" id="streets">
                                        <option disabled selected>Zgjedh rrugën...</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3 pe-2" id="streetByNeighborhood">
                                    <label>Rruga</label>
                                    <select class="form-select option-select" asp-for="Street" id="streetsNeighborhood">
                                        <option disabled selected>Zgjedh rrugën...</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3 pe-2">
                                    <label class="">Numri i shtëpisë</label>
                                    <input class="form-control" placeholder="opsionale" min="0" asp-for="HouseNo" >
                                    <span class="text-danger"></span>
                                </div>
                            </div>
                        }
                        @if (User.IsInRole(roles.KryetarIPartise) || User.IsInRole(roles.KryetarIKomunes) || User.IsInRole(roles.AnetarIThjeshte))
                        {
                            <div class="mb-4 d-flex justify-content-between flex-md-row flex-column">
                                <div class="col-md-4 mb-2 pe-2" id="streetByVillage">
                                    <label>Rruga</label>
                                    <select class="form-select option-select" asp-for="Street" id="streets">
                                        <option disabled selected>Zgjedh rrugën...</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3 pe-2" id="streetByNeighborhood">
                                    <label>Rruga</label>
                                    <select class="form-select option-select" asp-for="Street" id="streetsNeighborhood">
                                        <option disabled selected>Zgjedh rrugën...</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3 pe-2">
                                    <label>Blloku</label>
                                    <select class="form-select option-select" asp-for="Block" id="blocks">
                                        <option disabled selected>Zgjedh bllokun...</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3 pe-2">
                                    <label class="">Numri i shtëpisë</label>
                                    <input class="form-control option-select" placeholder="opsionale" asp-for="HouseNo" min="0">
                                    <span class="text-danger"></span>
                                </div>
                            </div>
                        }
                        <h6 class="pt-4">II - Të dhënat profesionale</h6><hr>
                        <div class=" mb-4 d-flex justify-content-between flex-md-row flex-column">
                            <div class="col-md-4 mb-3 pe-2">
                                <label class="">Vendi i punës</label>
                                <input asp-for="WorkPlace" class="form-control" >

                            <span asp-validation-for="WorkPlace" class="text-danger"></span>
                                
                            </div>
                            <div class="col-md-4 mb-2 pe-2 ">
                                <label>Sektori</label>
                                <select class="form-select " asp-for="AdministrativeUnit" id="inputGroupSelect04" asp-items="@ViewBag.administrativeUnits">
                                    <option disabled selected>Zgjedh sektorin...</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3 pe-2">
                                <label class="l">Detyra</label>
                                <input asp-for="Duty" class="form-control">
                            <span asp-validation-for="Duty" class="text-danger"></span>
                                
                            </div>
                        </div>
                        <h6 class="pt-4">III - Të dhënat partiake<hr></h6>
                        <div class="d-flex justify-content-between flex-sm-row flex-column">
                            <div class="col-sm-6 mb-2 pe-2">
                                <label for="FamilyMember" class="">Numri i anëtarëve</label>
                                <input asp-for="FamMembers" type="number" class="form-control" id="FamilyMember" value="1" min="0">
                                <span asp-validation-for="FamMembers" class="text-danger"></span>
                            </div>
                            <div class="col-sm-6 mb-3 pe-2">
                                <label>Gjasat e suksesit fillestar</label>
                                <select class="form-select" id="inputGroupSelect05" asp-for="SuccessChance" placeorder="Zgjedh gjasat..." asp-items="@ViewBag.successChances">
                                </select>
                            </div>
                        </div>
                        <div class="mb-4 d-flex justify-content-between flex-sm-row flex-column">
                            <div class="col-sm-6 mb-3 pe-2">
                                <label>Votues i tanishëm</label>
                                <select class="form-select option-select" id="inputGroupSelect04" asp-for="PoliticalSubject" asp-items="@ViewBag.PS" required>
                                    <option disabled selected>Zgjedh partinë...</option>
                                </select>
                                <span asp-validation-for="PoliticalSubject" class="text-danger"></span>

                            </div>
                            <div class="col-sm-6 mb-3 pe-2" id="pollcenter-villages-container">
                                <label>Qendra e votimit</label>
                                <select class="form-select option-select" id="poll" asp-for="PollCenter">
                                    <option disabled selected>Zgjedh qendren e votimit...</option>
                                </select>
                                <span asp-validation-for="PollCenter" class="text-danger"></span>

                            </div>
                            <div class="col-sm-6 mb-3 pe-2" id="pollcenter-neighborhood-container">
                                <label>Qendra e votimit</label>
                                <select class="form-select option-select" id="pollNeighborhood" asp-for="PollCenter">
                                    <option disabled selected>Zgjedh qendren e votimit...</option>
                                </select>
                                <span asp-validation-for="PollCenter" class="text-danger"></span>
                            </div>
                        </div>
                        @if(User.IsInRole(roles.AnetarIThjeshte)){
                        <div class="d-flex flex-row justify-content-end pe-2 pt-3 button-responsive">
                            <a href='javascript:
                               swal({
                               title: "A jeni të sigurtë?" ,
                               icon: "warning" ,
                               buttons: {
                               cancel:"Jo",
                               confirm:{
                               text:"Po",
                               className:"test",
                               } }
                               })
                               .then((willDelete)=>
                                {
                                if (willDelete) {
                                swal({ title: "U anulua me sukses!",
                                icon: "success"}).then(okay => {
                                if (okay) {
                                window.location.href = "/AddsAdmin/AddVoter";
                                }
                                });
                                } else {
                                swal({
                                title: "Te dhënat nuk janë anuluar!",
                                icon: "error",
                                });
                                }
                                });'
                                class = "btnanulo btn btn-danger">Anulo
                            </a>&nbsp &nbsp
                            <button asp-action="SaveAndOpenCase" asp-controller="AddsAdmin" class="btn btn-primary pe-2 button-responsive">Ruaj dhe hap rast</button>&nbsp &nbsp
                            </div>
                        }else{
                        <div class="d-flex flex-row justify-content-end pe-2 pt-3 button-responsive">
                            <a href='javascript:
                               swal({
                               title: "A jeni të sigurtë?" ,
                               icon: "warning" ,
                               buttons: {
                               cancel:"Jo",
                               confirm:{
                               text:"Po",
                               className:"test",
                               } }
                               })
                               .then((willDelete)=>
                                {
                                if (willDelete) {
                                swal({ title: "U anulua me sukses!",
                                icon: "success"}).then(okay => {
                                if (okay) {
                                window.location.href = "/AddsAdmin/AddVoter";
                                }
                                });
                                } else {
                                swal({
                                title: "Te dhënat nuk janë anuluar!",
                                icon: "error",
                                });
                                }
                                });'
                                class = "btnanulo btn btn-danger">Anulo
                            </a>&nbsp &nbsp
                            <button asp-action="SaveAndOpenCase" asp-controller="AddsAdmin" class="btn btn-primary pe-2 button-responsive">Ruaj dhe hap rast</button>&nbsp &nbsp
                            <button type="submit" class="btn btn-primary pe-2 button-responsive">Ruaj dhe mbyll</button>
                        </div>
                        }
                       
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>
@if (User.IsInRole(roles.KryetarIKomunes))
{
    @section Scripts
    { <script src="~/js/add_votter_kryetari_komunes.js"> </script> }
}
else if (User.IsInRole("KryetarIFshatit"))
{
    @section Scripts
    { <script src="~/js/add_votter_kryetari_fshatit.js"> </script> }
}
else if (User.IsInRole("AnetarIThjeshte"))
{
    @section Scripts
    { <script src="~/js/add_votter_antari_thjesht.js"> </script> }
}
else
{
    @section Scripts
    { <script src="~/js/add_votter_admin.js">  </script>}
}
